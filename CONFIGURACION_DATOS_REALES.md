# 🔧 Configuración para Datos Reales - Dashboard Energético

## 🎯 Objetivo
Convertir el proyecto de datos simulados a datos reales conectando con Oracle Database.

## 📋 Pasos para Configuración Completa

### 1. 🔑 Crear archivo .env con las claves necesarias

```bash
# Crear archivo .env en la raíz del proyecto
cp env.example .env
```

**Contenido del archivo .env:**
```bash
# ===========================================
# CONFIGURACIÓN OBLIGATORIA PARA DATOS REALES
# ===========================================

# Base de Datos Oracle (OBLIGATORIO)
ORACLE_USER=energy_user
ORACLE_PASSWORD=tu_password_seguro_aqui
ORACLE_CONNECTION_STRING=localhost:1521/XE
ORACLE_POOL_MIN=2
ORACLE_POOL_MAX=10
ORACLE_POOL_TIMEOUT=60
ORACLE_QUEUE_TIMEOUT=60000

# JWT Secret (OBLIGATORIO)
JWT_SECRET=tu-jwt-secret-muy-seguro-para-produccion-2024

# Configuración del Servidor
NODE_ENV=development
PORT=3001
FRONTEND_URL=http://localhost:3000

# ===========================================
# CONFIGURACIÓN OPCIONAL (RECOMENDADA)
# ===========================================

# Email para notificaciones
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=tu-email@gmail.com
SMTP_PASS=tu-app-password-gmail

# Redis para caché
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# Configuración de Seguridad
CORS_ORIGIN=http://localhost:3000
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Configuración de Logging
LOG_LEVEL=info
ENABLE_METRICS=true
METRICS_PORT=9090
```

### 2. 🐳 Configurar con Docker (MÁS FÁCIL)

```bash
# Iniciar Oracle Database con Docker
docker-compose up -d oracle

# Esperar a que Oracle esté listo (2-3 minutos)
docker-compose logs -f oracle

# Iniciar el resto de servicios
docker-compose up -d
```

### 3. 🗄️ Crear estructura de base de datos

**Conectar a Oracle:**
```bash
# Usando Docker
docker exec -it dashboard_oracle_1 sqlplus energy_user/energy_password@//localhost:1521/XE

# O usando cliente Oracle
sqlplus energy_user/energy_password@//localhost:1521/XE
```

**Ejecutar scripts SQL:**
```sql
-- Crear tablas principales
CREATE TABLE energy_metrics (
    id VARCHAR2(50) PRIMARY KEY,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    kwh_d NUMBER(15,2),
    kvarh_d NUMBER(15,2),
    kwh_r NUMBER(15,2),
    kvarh_r NUMBER(15,2),
    kvarh_penalized NUMBER(15,2),
    obis_code VARCHAR2(20),
    meter_id VARCHAR2(50),
    location VARCHAR2(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE alerts (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    type VARCHAR2(20) NOT NULL,
    message VARCHAR2(500) NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    severity VARCHAR2(20) DEFAULT 'medium',
    resolved NUMBER(1) DEFAULT 0,
    location VARCHAR2(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE users (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) UNIQUE NOT NULL,
    role VARCHAR2(20) DEFAULT 'viewer',
    status VARCHAR2(20) DEFAULT 'active',
    last_login TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insertar datos de ejemplo
INSERT INTO energy_metrics (id, kwh_d, kvarh_d, kwh_r, kvarh_r, kvarh_penalized, obis_code, meter_id, location) VALUES
('1', 1250, 320, 50, 15, 25, '1.8.0', 'M001', 'Planta Norte'),
('2', 980, 280, 30, 10, 20, '1.8.0', 'M002', 'Oficinas Centrales'),
('3', 2100, 450, 80, 25, 35, '1.8.0', 'M003', 'Centro de Datos');

INSERT INTO alerts (type, message, severity, location) VALUES
('warning', 'Consumo alto en hora pico', 'high', 'Planta Norte'),
('info', 'Factor de potencia optimizado', 'low', 'Centro de Datos'),
('success', 'Meta de eficiencia alcanzada', 'low', 'Oficinas Centrales');

INSERT INTO users (name, email, role) VALUES
('Juan Pérez', 'juan.perez@empresa.com', 'admin'),
('María García', 'maria.garcia@empresa.com', 'operator'),
('Carlos López', 'carlos.lopez@empresa.com', 'viewer');

COMMIT;
```

### 4. 🔄 Modificar el código para usar datos reales

**Cambiar Dashboard.tsx:**
```typescript
// Reemplazar datos simulados con consultas reales
const { data: realTimeMetrics, isLoading: isLoadingMetrics } = useGetRealTimeMetricsQuery();
const { data: energySummary, isLoading: isLoadingSummary } = useGetEnergySummaryQuery({ period: selectedPeriod });
const { data: alerts, isLoading: isLoadingAlerts } = useGetAlertsQuery();
```

**Cambiar ExecutiveDashboard.tsx:**
```typescript
// Reemplazar datos simulados con consultas reales
const { data: kpisData } = useGetExecutiveKPIsQuery();
const { data: alertsData } = useGetExecutiveAlertsQuery();
const { data: trendsData } = useGetExecutiveTrendsQuery();
```

### 5. 🚀 Iniciar el proyecto

```bash
# Backend
cd backend
npm install
npm run build
npm start

# Frontend (en otra terminal)
cd frontend
npm install
npm start
```

## 🔍 Verificación

### URLs de acceso:
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:3001/api
- **Oracle Database**: localhost:1521
- **Oracle Enterprise Manager**: http://localhost:5500

### Verificar conexión:
```bash
# Verificar que Oracle esté corriendo
docker-compose ps

# Verificar logs del backend
docker-compose logs backend

# Verificar logs del frontend
docker-compose logs frontend
```

## 🆘 Solución de Problemas

### Error de conexión a Oracle:
```bash
# Verificar que Oracle esté listo
docker-compose logs oracle | grep "DATABASE IS READY"

# Verificar conectividad
telnet localhost 1521
```

### Error de permisos:
```bash
# Dar permisos a Docker
sudo chown -R $USER:$USER .
```

### Error de memoria:
```bash
# Aumentar memoria para Docker
# En Docker Desktop > Settings > Resources > Memory > 4GB+
```

## 📊 Resultado Final

Una vez configurado correctamente, tendrás:
- ✅ **Datos reales** de Oracle Database
- ✅ **Actualizaciones en tiempo real**
- ✅ **Alertas dinámicas**
- ✅ **Métricas precisas**
- ✅ **Reportes con datos reales**
- ✅ **Autenticación funcional**
- ✅ **Notificaciones por email**

## 🔐 Seguridad

**IMPORTANTE:**
1. **Cambiar todas las contraseñas** por defecto
2. **Usar HTTPS** en producción
3. **Configurar firewall** apropiadamente
4. **Hacer backup** regular de la base de datos
5. **Monitorear logs** de seguridad
